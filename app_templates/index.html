<!DOCTYPE html>
<html lang="en">
<head>
    <title>DrinkBot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
</head>
<style>
</style>
<body style="background-color:#0f1012;">
<br/>
<div class="text-white text-center">
  <h1 class="display-1 fw-bold">DrinkBot</h1>
</div>
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="alert alert-danger d-flex align-items-center alert-dismissible fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <div>
                Oops, dont forget the cup!                
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
</div>
<div class="progress" style="height: 30px; background-color:#0f1012;">
    <div class="progress-bar progress-bar-striped progress-bar-animated bg-secondary" role="progressbar" id="statusvalue" style="width: 0%"></div>
</div>
<br/>
<div class="row">
    <h1 class="display-3 fw-normal text-begin text-white">Control Center:</h1>
</div>
<br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_one_name}}</p>
    </div>
    <div class="col-3">
        <div class="container text-end">
            <button type="button" class="btn btn-success btn-lg" onclick="drinkOne()" id="drink_one" {{drink_one_state}}>Pour</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_one_amount}}</p>
    </div>
    <div class="col-3">
    </div>        
</div>
<br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_two_name}}</p>
    </div>
    <div class="col-3">
        <div class="container text-end">
            <button type="button" class="btn btn-success btn-lg" onclick="drinkTwo()" id="drink_two" {{drink_two_state}}>Pour</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_two_amount}}</p>
    </div>
    <div class="col-3">
    </div>        
</div>
<br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_three_name}}</p>
    </div>
    <div class="col-3">
        <div class="container text-end">
            <button type="button" class="btn btn-success btn-lg" onclick="drinkThree()" id="drink_three" {{drink_three_state}}>Pour</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_three_amount}}</p>
    </div>
    <div class="col-3">
    </div>        
</div>
<br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_four_name}}</p>
    </div>
    <div class="col-3">
        <div class="container text-end">
            <button type="button" class="btn btn-success btn-lg" onclick="drinkFour()" id="drink_four" {{drink_four_state}}>Pour</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-center text-white">{{drink_four_amount}}</p>
    </div>
    <div class="col-3">
    </div>        
</div>
<div class="row">
    <div class="col">
        <div class="container mt-3 text-center">
            <button type="button" class="btn btn-primary" id="editBtn">Settings</button>
        </div>
    </div>
</div>
</br>
<script>
if ( window.history.replaceState ) {
  window.history.replaceState( null, null, window.location.href );
}
</script>
<script type="text/javascript">
    var drink_one_s = "{{drink_one_state}}";
    var drink_two_s = "{{drink_two_state}}";
    var drink_three_s = "{{drink_three_state}}";
    var drink_four_s = "{{drink_four_state}}";
    
    var drink_one_n = "{{drink_one_name}}";
    var drink_two_n = "{{drink_two_name}}";
    var drink_three_n = "{{drink_three_name}}";
    var drink_four_n = "{{drink_four_name}}";
   
    var drink_one_a = "{{drink_one_amount}}";
    var drink_two_a = "{{drink_two_amount}}";
    var drink_three_a = "{{drink_three_amount}}";
    var drink_four_a = "{{drink_four_amount}}";
    
    function ed_drinks(drink_bool) {
        if (drink_one_s === "on") {
            document.getElementById("drink_one").disabled = drink_bool;
        } if (drink_two_s === "on") {
            document.getElementById("drink_two").disabled = drink_bool;
        } if (drink_three_s === "on") {
            document.getElementById("drink_three").disabled = drink_bool;
        } if (drink_four_s === "on") {
            document.getElementById("drink_four").disabled = drink_bool;
        }
    }
    
    function drink_check(drink_name, drink_amount) {
        if (drink_name === 'one') {
            var drink_n = drink_one_n;
        } else if (drink_name === 'two') {
            var drink_n = drink_two_n;
        } else if (drink_name === 'three') {
            var drink_n = drink_three_n;
        } else if (drink_name === 'four') {
            var drink_n = drink_four_n;
        } progress_bar(drink_n, drink_amount);}
        
    function progress_bar(drink_name, drink_amount) {
        ed_drinks(true)
        var drink_amount_split = drink_amount.split(" ");
        var drink_num = drink_amount_split[0];
        var num_length = drink_num.length;
        if (num_length === 3) {
            var float_array = drink_num.split(".");
            var first = float_array[0];
            var second = float_array[1];
            var together = first + second + "00";
            var num = Number(together);
        } else
            if (num_length === 1) {
                var together = drink_num + "000";
                var check_num = Number(together);
                if (check_num === 3000) {
                    var num = check_num;
                } else
                    if (check_num === 4000) {
                        var num = check_num + 250;
                    } else
                        if (check_num === 5000) {
                            var num = check_num + 500;
                        }
        }  
        var total_seconds = num + 18000;
        var value = 0;
        let id = setInterval(function(){
            value++;
            document.getElementById('statusvalue').innerHTML = value + "% - " + " Pouring " + drink_name;
            document.getElementById('statusvalue').style.width = value + "%";
            if (value >= 100){
                clearInterval(id);
                document.getElementById('statusvalue').style.width = "100%";
                document.getElementById('statusvalue').innerHTML = "100% - " + drink_name + " Served, Enjoy!";
                setTimeout(stop_bar, 5000);
            }
        }, total_seconds / 100); 
    }
    
    function stop_bar() {
        document.getElementById('statusvalue').style.width = "0%";
        ed_drinks(false)
    }
    
    var myModal = new bootstrap.Modal(document.getElementById("myModal"),{});
    let cup_status = false;
    
    function cupTrue() {
        cup_status = true;
    }
    
    function cupFalse() {
        cup_status = false;
    }
    
    async function drinkOne() {
        if (cup_status) {
            myModal.hide()
            progress_bar(drink_one_n, drink_one_a);
            await fetch('/drink_one');
        } else {
            myModal.show()
        }
    }
    
    async function drinkTwo() {
        if (cup_status) {
            myModal.hide()
            progress_bar(drink_two_n, drink_two_a);
            await fetch('/drink_two');
        } else {
            myModal.show()
        }
    }
    
    async function drinkThree() {
        if (cup_status) {
            myModal.hide()
            progress_bar(drink_three_n, drink_three_a);
            await fetch('/drink_three');
        } else {
            myModal.show()
        }
    }
    
    async function drinkFour() {
        if (cup_status) {
            myModal.hide()
            progress_bar(drink_four_n, drink_four_a);
            await fetch('/drink_four');
        } else {
            myModal.show()
        }
    }
    
</script>
<script src="data:text/javascript,document.getElementById('editBtn').onclick = function() { window.location.href = '/edit'; };" defer></script>
<script src="data:text/javascript,document.getElementById('savedrinks').onclick = function() { window.location.href = '/'; };" defer></script>
<script src="data:text/javascript,async function getStatus() {const t = await fetch('/status'); const tVal = await t.text(); var tVal_l = tVal.length; if (tVal === 'nocup') {cupFalse()} else if (tVal === 'yescup') {cupTrue()} else if (tVal_l > 6) {var split_tVal = tVal.split(' '); drink_check(split_tVal[0], split_tVal[1])} setTimeout(getStatus, 1000)}; getStatus();" defer></script>
</body>
</html>

