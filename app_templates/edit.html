<!DOCTYPE html>
<html lang="en">
<head>
    <title>DrinkBot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
</head>
<body style="background-color:#0f1012;">
<br/>
<div class="text-white text-center">
  <h1 class="display-1 fw-bold">DrinkBot</h1>
</div>
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="alert alert-danger d-flex align-items-center alert-dismissible fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <div>
                Oops, dont forget the cup!                
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
</div>
<div class="progress" style="height: 30px; background-color:#0f1012;">
    <div class="progress-bar progress-bar-striped progress-bar-animated bg-secondary" role="progressbar" id="statusvalue" style="width: 0%"></div>
</div>
<br/>
<div class="row">
    <h1 class="display-3 fw-normal text-begin text-white">Edit Center:</h1>
</div>
<br/>
<form id="drinkForm">
<div class="row">
    <div class="col-8">
        <p class="display-6 text-begin text-white">Drink One Activate:</p>
    </div>
    <div class="col-4 d-flex justify-content-center form-check fs-1 form-switch text-white">
        <input class="form-check-input" type="checkbox" role="switch" onclick="OneisChecked()" name="drink_one_state" id="drink_one_state" value="{{drink_one_state}}" {{drink_one_t}}>
        <label class="form-check-label display-6" for="toggle_drink_one"></label>
    </div>
</div>    
    <div class="row">
        <div class="col-4">
            <input type="text" class="form-control" onchange="inputChange()"  id="drink_one_name" name="drink_one_name" placeholder="{{drink_one_name}}">
        </div>
        <div class="col-4">
            <select class="form-select" style="width:auto;" onchange="inputChange()" id="drink_one_amount" name="drink_one_amount" aria-label="drink_one_amount">
                <option selected>{{drink_one_amount}}</option>
                <option value="1.5 oz. (Single)">1.5 oz. (Single)</option>
                <option value="3 oz. (Double)">3 oz. (Double)</option>
                <option value="4 oz. (Glass)">4 oz. (Glass)</option>
                <option value="5 oz. (Glass)">5 oz. (Glass)</option>
            </select>
        </div>
        <div class="col-4">
            <div class="container text-center">
                <button type="button" class="btn btn-warning" onclick="drinkOneP()" id="drink_one_prime">Prime</button>
            </div>
        </div>  
    </div>
       
    <br/>
    <br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-begin text-white">Drink Two Activate:</p>
    </div>
    <div class="col-4 d-flex justify-content-center form-check fs-1 form-switch text-white">
        <input class="form-check-input" type="checkbox" role="switch" onclick="TwoisChecked()" name="drink_two_state" id="drink_two_state" value="{{drink_two_state}}" {{drink_two_t}}>
        <label class="form-check-label display-6" for="toggle_drink_two"></label>
    </div>
</div>    
    <div class="row">
        <div class="col-4">
            <input type="text" class="form-control" onchange="inputChange()" id="drink_two_name" name="drink_two_name" placeholder="{{drink_two_name}}">
        </div>
        <div class="col-4">
            <select class="form-select" style="width:auto;" onchange="inputChange()" id="drink_two_amount" name="drink_two_amount" aria-label="drink_two_amount">
                <option selected>{{drink_two_amount}}</option>
                <option value="1.5 oz. (Single)">1.5 oz. (Single)</option>
                <option value="3 oz. (Double)">3 oz. (Double)</option>
                <option value="4 oz. (Glass)">4 oz. (Glass)</option>
                <option value="5 oz. (Glass)">5 oz. (Glass)</option>
            </select>
        </div>
        <div class="col-4">
            <div class="container text-center">
                <button type="button" class="btn btn-warning" onclick="drinkTwoP()" id="drink_two_prime">Prime</button>
            </div>
        </div>  
    </div>
    <br/>
    <br/>
<div class="row">
    <div class="col-8">
        <p class="display-6 text-begin text-white">Drink Three Activate:</p>
    </div>
    <div class="col-4 d-flex justify-content-center form-check fs-1 form-switch text-white">
        <input class="form-check-input" type="checkbox" role="switch" onclick="ThreeisChecked()" name="drink_three_state" id="drink_three_state" value="{{drink_three_state}}" {{drink_three_t}}>
        <label class="form-check-label display-6" for="toggle_drink_three"></label>
    </div>
</div>    
    <div class="row">
        <div class="col-4">
            <input type="text" class="form-control" onchange="inputChange()" id="drink_three_name" name="drink_three_name" placeholder="{{drink_three_name}}">
        </div>
        <div class="col-4">
            <select class="form-select" style="width:auto;" onchange="inputChange()" id="drink_three_amount" name="drink_three_amount" aria-label="drink_three_amount">
                <option selected>{{drink_three_amount}}</option>
                <option value="1.5 oz. (Single)">1.5 oz. (Single)</option>
                <option value="3 oz. (Double)">3 oz. (Double)</option>
                <option value="4 oz. (Glass)">4 oz. (Glass)</option>
                <option value="5 oz. (Glass)">5 oz. (Glass)</option>
            </select>
        </div>
        <div class="col-4">
            <div class="container text-center">
                <button type="button" class="btn btn-warning" onclick="drinkThreeP()" id="drink_three_prime">Prime</button>
            </div>
        </div>  
    </div>
    <br/>
    <br/>
<div class="row"> 
    <div class="col-8">
        <p class="display-6 text-begin text-white">Drink Four Activate:</p>
    </div>
    <div class="col-4 d-flex justify-content-center form-check fs-1 form-switch text-white">
        <input class="form-check-input" type="checkbox" role="switch" onclick="FourisChecked()" name="drink_four_state" id="drink_four_state" value="{{drink_four_state}}" {{drink_four_t}}>
        <label class="form-check-label display-6" for="toggle_drink_four"></label>
    </div>
</div>    
    <div class="row">
        <div class="col-4">
            <input type="text" class="form-control" onchange="inputChange()" id="drink_four_name" name="drink_four_name" placeholder="{{drink_four_name}}">
        </div>
        <div class="col-4">
            <select class="form-select" style="width:auto;" onchange="inputChange()" id="drink_four_amount" name="drink_four_amount" aria-label="drink_four_amount">
                <option selected>{{drink_four_amount}}</option>
                <option value="1.5 oz. (Single)">1.5 oz. (Single)</option>
                <option value="3 oz. (Double)">3 oz. (Double)</option>
                <option value="4 oz. (Glass)">4 oz. (Glass)</option>
                <option value="5 oz. (Glass)">5 oz. (Glass)</option>
            </select>
        </div>
        <div class="col-4">
            <div class="container text-center">
                <button type="button" class="btn btn-warning" onclick="drinkFourP()" id="drink_four_prime">Prime</button>
            </div>
        </div>  
    </div>
    <br/>
    <div class="row">
         <div class="col">
            <div class="container mt-3 pr-5 text-center">
                <button type="button" class="btn btn-primary" id="home">Home</button>
            </div>
        </div>
        <div class="col">
            <div class="container mt-3 text-center">
                <button type=button" class="btn btn-success" id="save" onclick="submitForm()">Save</button>
            </div>
        </div>
        <div class="col">
            <div class="container mt-3 text-center">
                <button type="button" class="btn btn-danger" id="resetBtn">Reset</button>
            </div>
        </div>
    </div>
</form>
<script>
    var drinkOnestate = document.getElementById("drink_one_state");
    var drinkOnename = document.getElementById("drink_one_name");
    var drinkOneamount = document.getElementById("drink_one_amount");
    var drinkOneprime = document.getElementById("drink_one_prime");
    var drinkTwostate = document.getElementById("drink_two_state");
    var drinkTwoname = document.getElementById("drink_two_name");
    var drinkTwoamount = document.getElementById("drink_two_amount");
    var drinkTwoprime = document.getElementById("drink_two_prime");
    var drinkThreestate = document.getElementById("drink_three_state");
    var drinkThreename = document.getElementById("drink_three_name");
    var drinkThreeamount = document.getElementById("drink_three_amount");
    var drinkThreeprime = document.getElementById("drink_three_prime");
    var drinkFourstate = document.getElementById("drink_four_state");
    var drinkFourname = document.getElementById("drink_four_name");
    var drinkFouramount = document.getElementById("drink_four_amount");
    var drinkFourprime = document.getElementById("drink_four_prime");
    var drink_one_s = "{{drink_one_state}}";
    var drink_one_n = "{{drink_one_name}}";
    var drink_one_a = "{{drink_one_amount}}";
    var drink_two_s = "{{drink_two_state}}";
    var drink_two_n = "{{drink_two_name}}";
    var drink_two_a = "{{drink_two_amount}}";
    var drink_three_s = "{{drink_three_state}}";
    var drink_three_n = "{{drink_three_name}}";
    var drink_three_a = "{{drink_three_amount}}";
    var drink_four_s = "{{drink_four_state}}";
    var drink_four_n = "{{drink_four_name}}";
    var drink_four_a = "{{drink_four_amount}}";
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById("save").disabled = true;
        if (drink_one_s === "on") {
            drinkOnestate.checked = true;
            drinkOnename.disabled = false;
            drinkOneamount.disabled = false;
            drinkOneprime.disabled = false;
        } else {
            drinkOnestate.checked = false;
            drinkOnename.disabled = true;
            drinkOneamount.disabled = true;
            drinkOneprime.disabled = true;
        }
        if (drink_two_s === "on") {
            drinkTwostate.checked = true;
            drinkTwoname.disabled = false;
            drinkTwoamount.disabled = false;
            drinkTwoprime.disabled = false;
        } else {
            drinkTwostate.checked = false;
            drinkTwoname.disabled = true;
            drinkTwoamount.disabled = true;
            drinkTwoprime.disabled = true;
        }
        if (drink_three_s === "on") {
            drinkThreestate.checked = true;
            drinkThreename.disabled = false;
            drinkThreeamount.disabled = false;
            drinkThreeprime.disabled = false;
        } else {
            drinkThreestate.checked = false;
            drinkThreename.disabled = true;
            drinkThreeamount.disabled = true;
            drinkThreeprime.disabled = true;
        }
        if (drink_four_s === "on") {
            drinkFourstate.checked = true;
            drinkFourname.disabled = false;
            drinkFouramount.disabled = false;
            drinkFourprime.disabled = false;
        } else {
            drinkFourstate.checked = false;
            drinkFourname.disabled = true;
            drinkFouramount.disabled = true;
            drinkFourprime.disabled = true;
        }
            
    });
</script>
<script>
    function OneisChecked() {
        document.getElementById("save").disabled = false;
        if (drinkOnestate.checked) {
            drinkOnename.disabled = false;
            drinkOneamount.disabled = false;
            drinkOneprime.disabled = false;
            drinkOnestate.value = "on";
        } else {
            drinkOnename.disabled = true;
            drinkOneamount.disabled = true;
            drinkOneprime.disabled = true;
            drinkOnestate.value = "off";
        }
   }
</script>
<script>
    function TwoisChecked() {
        document.getElementById("save").disabled = false;
        if (drinkTwostate.checked) {
            drinkTwoname.disabled = false;
            drinkTwoamount.disabled = false;
            drinkTwoprime.disabled = false;
            drinkTwostate.value = "on";
        } else {
            drinkTwoname.disabled = true;
            drinkTwoamount.disabled = true;
            drinkTwoprime.disabled = true;
            drinkTwostate.value = "off";
        }
    }
</script>
<script>
    function ThreeisChecked() {
        document.getElementById("save").disabled = false;
        if (drinkThreestate.checked) {
            drinkThreename.disabled = false;
            drinkThreeamount.disabled = false;
            drinkThreeprime.disabled = false;
            drinkThreestate.value = "on";
        } else {
            drinkThreename.disabled = true;
            drinkThreeamount.disabled = true;
            drinkThreeprime.disabled = true;
            drinkThreestate.value = "off";
        }
    }
</script>
<script>
    function FourisChecked() {
        document.getElementById("save").disabled = false;
        if (drinkFourstate.checked) {
            drinkFourname.disabled = false;
            drinkFouramount.disabled = false;
            drinkFourprime.disabled = false;
            drinkFourstate.value = "on";
        } else {
            drinkFourname.disabled = true;
            drinkFouramount.disabled = true;
            drinkFourprime.disabled = true;
            drinkFourstate.value = "off";
        }
    }
</script>
<script>
    function inputChange() {
        document.getElementById("save").disabled = false;  
    }
</script>
<script>
    function submitForm() {
        event.preventDefault();
        var old_values = {drink_one_state: drink_one_s, drink_one_name: drink_one_n, drink_one_amount: drink_one_a, drink_two_state: drink_two_s, drink_two_name: drink_two_n, drink_two_amount: drink_two_a, drink_three_state: drink_three_s, drink_three_name: drink_three_n, drink_three_amount: drink_three_a, drink_four_state: drink_four_s, drink_four_name: drink_four_n, drink_four_amount: drink_four_a}
        var new_values = {drink_one_state: drinkOnestate.value, drink_one_name: drinkOnename.value,  drink_one_amount: drinkOneamount.value, drink_two_state: drinkTwostate.value, drink_two_name: drinkTwoname.value, drink_two_amount: drinkTwoamount.value, drink_three_state: drinkThreestate.value, drink_three_name: drinkThreename.value, drink_three_amount: drinkThreeamount.value, drink_four_state: drinkFourstate.value, drink_four_name: drinkFourname.value, drink_four_amount: drinkFouramount.value}
        send_data = {}
        var empty_string = '';
        for (var key in old_values) {
            if (new_values.hasOwnProperty(key)) {
                if (old_values[key] != new_values[key]) {
                    if (new_values[key] !== empty_string) {
                        send_data[key] = new_values[key];
                    }
                }               
            }
        }
        const formData = new FormData();
        for (const keys in send_data) {
            formData.append(keys, send_data[keys]);
        }
        fetch('/edit', {
            method: 'POST',
            body: formData
        })
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        document.getElementById("save").disabled = true;
        sleep(1200).then(() => {window.location.href = "/edit";});
    }
    
    function progress_bar(drink_name, drink_amount, pump_number) {
        ed_drinks(true)
        var drink_amount_split = drink_amount.split(" ");
        var drink_num = drink_amount_split[0];
        var num_length = drink_num.length;
        if (num_length === 3) {
            var float_array = drink_num.split(".");
            var first = float_array[0];
            var second = float_array[1];
            var together = first + second + "00";
            var num = Number(together);
        } else
            if (num_length === 1) {
                var together = drink_num + "000";
                var check_num = Number(together);
                if (check_num === 3000) {
                    var num = check_num;
                } else
                    if (check_num === 4000) {
                        var num = check_num + 250;
                    } else
                        if (check_num === 5000) {
                            var num = check_num + 500;
                        }
        }  
        var total_seconds = num + 18000;
        var value = 0;
        let id = setInterval(function(){
            value++;
            document.getElementById('statusvalue').innerHTML = value + "% - " + " Priming Pump " + pump_number + " (" + drink_name + ")";
            document.getElementById('statusvalue').style.width = value + "%";
            if (value >= 100){
                clearInterval(id);
                document.getElementById('statusvalue').style.width = "100%";
                document.getElementById('statusvalue').innerHTML = "100% - Finished Priming Pump " + pump_number + " (" + drink_name + ")";
                setTimeout(stop_bar, 5000);
            }
        }, total_seconds / 100); 
    }
    
    function stop_bar() {
        document.getElementById('statusvalue').style.width = "0%";
        ed_drinks(false)
    }
    
    function ed_drinks(drink_bool) {
        if (drinkOnestate.checked) {
            drinkOneprime.disabled = drink_bool;
        } if (drinkTwostate.checked) {
            drinkTwoprime.disabled = drink_bool;
        } if (drinkThreestate.checked) {
            drinkThreeprime.disabled = drink_bool;
        } if (drinkFourstate.checked) {
            drinkFourprime.disabled = drink_bool;
        }
    }
    
    var myModal = new bootstrap.Modal(document.getElementById("myModal"),{});
    let cup_status = false;
    
    function cupTrue() {
        cup_status = true;
    }
    
    function cupFalse() {
        cup_status = false;
    }
    
    let prime_time = "4 oz." 
    
    async function drinkOneP() {
        if (cup_status) {
            myModal.hide()
            const drinkOnename_value = drinkOnename.value;
            if (drinkOnename_value) {
                progress_bar(drinkOnename_value, prime_time, "One")
            } else {
                progress_bar(drink_one_n, prime_time, "One")
            }
            await fetch('/drink_one_prime');
        } else {
            myModal.show()
        } 
    }
    
    async function drinkTwoP() {
        if (cup_status) {
            myModal.hide()
            const drinkTwoname_value = drinkTwoname.value;
            if (drinkTwoname_value) {
                progress_bar(drinkTwoname_value, prime_time, "Two")
            } else {
                progress_bar(drink_two_n, prime_time, "Two")
            }
            await fetch('/drink_two_prime');
        } else {
            myModal.show()
        } 
    }
    
    async function drinkThreeP() {
        if (cup_status) {
            myModal.hide()
            const drinkThreename_value = drinkThreename.value;
            if (drinkThreename_value) {
                progress_bar(drinkThreename_value, prime_time, "Three")
            } else {
                progress_bar(drink_three_n, prime_time, "Three")
            }
            await fetch('/drink_three_prime');
        } else {
            myModal.show()
        } 
    }
    
    async function drinkFourP() {
        if (cup_status) {
            myModal.hide()
            const drinkFourname_value = drinkFourname.value;
            if (drinkFourname_value) {
                progress_bar(drinkFourname_value, prime_time, "Four")
            } else {
                progress_bar(drink_four_n, prime_time, "Four")
            }
            await fetch('/drink_four_prime');
        } else {
            myModal.show()
        } 
    }
    
</script>
<script src="data:text/javascript,document.getElementById('home').onclick = function() { window.location.href = '/'; };" defer></script>
<script src="data:text/javascript,document.getElementById('resetBtn').onclick = function() { window.location.href = '/reset'; };" defer></script>
<script src="data:text/javascript,async function getStatus() {const t = await fetch('/status'); const tVal = await t.text(); var tVal_l = tVal.length; if (tVal === 'nocup') {cupFalse()} else if (tVal === 'yescup') {cupTrue()}; setTimeout(getStatus, 1000)}; getStatus();" defer></script>
</body>
</html>